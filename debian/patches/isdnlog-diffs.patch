--- isdnutils-3.3.orig/isdnlog/isdnrep/isdnbill.c
+++ isdnutils-3.3/isdnlog/isdnrep/isdnbill.c
@@ -856,7 +856,7 @@
 #ifdef AK
   auto     FILE    *f = fopen("/www/log/isdn.log", "r");
 #else
-  auto     FILE    *f = fopen("/var/log/isdn.log", "r");
+  auto     FILE    *f = fopen("/var/lib/isdn/calls", "r");
 #endif
   auto     char     s[BUFSIZ], sx[BUFSIZ];
   auto     int      i, l, col, day, lday = UNKNOWN, month, lmonth = UNKNOWN;
--- isdnutils-3.3.orig/isdnlog/samples/stop
+++ isdnutils-3.3/isdnlog/samples/stop
@@ -1,37 +1,53 @@
 #!/bin/sh
 
-# very simple reload-example for the new chargemax feature of isdnlog
-# this is called by isdnlog every time we get a AOCD and chargesum of
-# active device is greater then CHARGEMAX.
-# there are three parameter available:
+# Very simple reload default for the chargemax feature of isdnlog.
+# This is called by isdnlog every time we get a AOCD and chargesum of
+# active device is greater than CHARGEMAX.
+# there are three parameters available:
 #
 #  first ($1) is chargesum-CHARGEMAX
 # second ($2) is ALIAS as defined in ISDNLOG.CONF
 #  third ($3) is total chargesum for active device
 
+msg=`tempfile -p isdn`
+
+myecho() {
+    echo "$@" >> $msg
+}
+
 case "$1" in
 5\.*)
-        echo "WARNING, charge-limit set by CHARGEMAX is reached!" >> /dev/console
-        echo "$2 is talking to much!" >> /dev/console
-#        /bin/aplay /usr/sounds/attention.au
+        myecho "WARNING, charge-limit set by CHARGEMAX is reached!"
+        myecho "$2 is talking too much!"
+#        /bin/play /usr/sounds/attention.au
         ;;
 
 10\.* | 11\.* )
-        echo "WARNING, $2 got charge-overflow == $1, total chargesum == $3" >> /dev/console
-        echo "next chargeint will cause i4l to stop" >> /dev/console
-#        /bin/aplay /usr/sounds/earthdestruction.au
+        myecho "WARNING, $2 got charge-overflow == $1, total chargesum == $3"
+        myecho "next chargeint will cause i4l to stop"
+#        /bin/play /usr/sounds/earthdestruction.au
         ;;
 
 20\.* | 21\.* )
-        echo "reload got charge-overflow == $1, now i4l will be stopped!" >> /dev/console
-        /sbin/init.d/i4l stop
+        myecho "reload got charge-overflow == $1, now ipppd will be stopped!"
+        /sbin/init.d/isdnutils stop ipppd
         ;;
 
 25\.* | 26\.* )
-        echo "aeh, still alive?! so we'll do a reboot!!" >> /dev/console
-#        /bin/aplay /usr/sounds/crash.au
-        /sbin/reboot
+#        echo "aeh, still alive?! so we'll do a reboot!!" >> /dev/console
+#        /bin/play /usr/sounds/crash.au
+#        /sbin/reboot
+        myecho "still alive?! Stopping ISDN subsystem!"
+        /usr/sbin/isdnctrl system off
         ;;
 esac
 
-echo "got charge_ov=$1 dev=$2 scharge=$3 " >> /dev/console
+myecho "got charge_ov=$1 dev=$2 scharge=$3 "
+
+if [ -s "$msg" ]; then
+    logger -f $msg -p daemon.notice -t isdnlog
+    cat $msg >> /dev/console
+fi
+rm -f $msg
+
+exit 0
--- isdnutils-3.3.orig/isdnlog/samples/rate.conf.default
+++ isdnutils-3.3/isdnlog/samples/rate.conf.default
@@ -0,0 +1 @@
+P:10
--- isdnutils-3.3.orig/isdnlog/tools/cdb/Makefile.in
+++ isdnutils-3.3/isdnlog/tools/cdb/Makefile.in
@@ -43,15 +43,15 @@
 	-rm config.{status,log,h,cache} Makefile .depend
 
 install-dirs:
-	install -d -m0755 $(MAN1DIR) $(MAN3DIR) $(LIBDIR) $(BINDIR) \
-		$(INCDIR)
+	install -d -m0755 $(MAN1DIR) $(MAN3DIR) $(LIBDIR) $(BINDIR) $(INCDIR)
 
 install:
-	install -m0755 $(BINS) $(BINDIR)
-	install -m0644 $(MAN1) $(MAN1DIR)
-	install -m0644 $(MAN3) $(MAN3DIR)
-	install -m0644 $(LIBS) $(LIBDIR)
-	install -m0644 freecdb.h freecdbmake.h $(INCDIR)
+	true
+	# install -m0755 $(BINS) $(BINDIR)
+	# install -m0644 $(MAN1) $(MAN1DIR)
+	# install -m0644 $(MAN3) $(MAN3DIR)
+	# install -m0644 $(LIBS) $(LIBDIR)
+	# install -m0644 freecdb.h freecdbmake.h $(INCDIR)
 
 cdbdump: cdbdump.o cdb_unpack.o
 
--- isdnutils-3.3.orig/isdnlog/tools/isdnrate.man
+++ isdnutils-3.3/isdnlog/tools/isdnrate.man
@@ -136,8 +136,9 @@
 .P
 .B \-D
 Start as a daemon, waiting for connections from a client. The socket
-.I /tmp/isdnrate
-is created, which clients can connect to.
+.I /var/run/isdnrate/socket
+is created, which clients can connect to
+(the socket can be changed by using the -O option).
 .P
 .B \-D2
 Start as a daemon and go background.
@@ -162,8 +163,8 @@
 provider is used.
 .P
 .BI \-O socketfile
-Write socket to given filename on start of daemon. Default is
-.IR tmp/isdnrate .
+Use given filename as the socket on start of daemon. Default is
+.IR /var/run/isdnrate/socket .
 .P
 .BI \-P piddir
 Write own PID to
--- isdnutils-3.3.orig/isdnlog/tools/tools.h
+++ isdnutils-3.3/isdnlog/tools/tools.h
@@ -586,6 +586,13 @@
 
 #define _GNU_SOURCE 1
 
+#include <sys/types.h>
+#include <sys/time.h>
+#include <sys/times.h>
+#include <sys/stat.h>
+#include <sys/resource.h>
+#include <sys/wait.h>
+#include <sys/socket.h>
 #include <stdio.h>
 #include <string.h>
 #include <errno.h>
@@ -594,12 +601,6 @@
 #include <stdlib.h>
 #include <stdarg.h>
 #include <unistd.h>
-#include <sys/time.h>
-#include <sys/times.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <sys/wait.h>
-#include <sys/socket.h>
 #include <netdb.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
--- isdnutils-3.3.orig/isdnlog/tools/zone.c
+++ isdnutils-3.3/isdnlog/tools/zone.c
@@ -523,7 +523,8 @@
 		from=sto;
 		sto=temp;
 	}
-	strncpy(newfrom, from, LENGTH-1);
+	if (newfrom != from)
+            memmove(newfrom, from, LENGTH-1);
 	while (strlen(newfrom)) {
 		UL lifrom = (UL) atol(newfrom); /* keys could be long */
 		US ifrom = (US) lifrom;
--- isdnutils-3.3.orig/isdnlog/holiday-default.dat
+++ isdnutils-3.3/isdnlog/holiday-default.dat
@@ -0,0 +1,18 @@
+V:-0.1 default [2001/10/10]
+
+W:1		Monday
+W:2		Tuesday
+W:3		Wednesday
+W:4		Thursday
+W:5		Friday
+W:6		Saturday
+W:7		Sunday
+W:W		weekday
+W:E		weekend
+W:H		holiday
+W:*		everyday
+
+D:1.1		New Year's Day
+D:easter	Easter
+D:1.5		May Day
+D:25.12		Christmas
--- isdnutils-3.3.orig/isdnlog/rate-default.dat
+++ isdnutils-3.3/isdnlog/rate-default.dat
@@ -0,0 +1,12 @@
+V:0.01-default [2001/10/10]
+
+U:%.3f UNITS
+
+P:10            .
+B:1234
+D:x
+
+# 1 currency unit per minute
+Z:1		.
+A:*
+T:*/*=1.00/60
--- ./isdnlog/Makefile.in~	2004-07-24 14:03:36.000000000 +0200
+++ ./isdnlog/Makefile.in	2004-08-24 19:51:57.000000000 +0200
@@ -2011,7 +2011,7 @@
 		  $(INSTALL_DATA) $$f $(DESTDIR)$(DATADIR); \
 		  echo Installing $(DESTDIR)$(DATADIR)/$$f; \
 		done
-		@(grep isdnlog $(SERVICEFILE) >/dev/null) || \
+		-@(grep isdnlog $(SERVICEFILE) >/dev/null) || \
 		(echo "";echo "";echo "Add a line to the file $(SERVICEFILE)" ;echo "";echo ""; \
 		echo "isdnlog $(SERV_PORT)/tcp        isdnlog" >> $(SERVICEFILE))
 
